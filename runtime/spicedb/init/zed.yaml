schema: |-
  definition user {}

  definition anonymous_user {}

  definition team {
  	// Recursive team structure to support groups of groups
  	relation owner: user | team#owner_or_member
  	relation member: user
  	permission owner_or_member = member + owner
  }

  definition collection {
  	// Recursive collection structure to support collections of collections
  	relation collection: collection
  	relation owner: user | team#owner_or_member
  	relation editor: user | team#owner_or_member
  	relation reader: user | team#owner_or_member | user:*

  	// Collection-level permissions
  	permission read = reader + update
  	permission update = editor + editor->owner_or_member + delete
  	permission delete = owner + owner->owner_or_member
  	permission make_public = delete
  	permission transfer_ownership = owner + owner->owner_or_member

  	// Item-level permissions
  	permission add_item = update
  }

  definition item {
  	relation collection: collection
  	relation reader: user | team#owner_or_member | anonymous_user:*
  	// Permissions are mostly inherited from collection, except support for one-off read permissions
  	permission read = reader + collection->read
  	permission update = collection->update
  	permission delete = collection->update
  }
relationships: |-
  team:super_admins#owner@user:alice
  team:admins#owner@team:super_admins#owner_or_member
  team:editors#owner@team:admins#owner_or_member
  team:editors#member@user:bob
  collection:public#owner@team:editors#owner_or_member
  collection:public#editor@team:editors#owner_or_member
  collection:public#reader@user:*
  collection:private#owner@team:admins#owner_or_member
  item:public/001#collection@collection:public
  item:public/002#collection@collection:public
  item:public/003#collection@collection:public
  item:public/004#collection@collection:public
  item:public/005#collection@collection:public
  item:public/006#collection@collection:public
  item:public/007#collection@collection:public
  item:public/008#collection@collection:public
  item:public/009#collection@collection:public
  item:public/010#collection@collection:public
  item:private/001#collection@collection:private
  item:private/002#collection@collection:private
  item:private/003#collection@collection:private
  item:private/004#collection@collection:private
  item:private/005#collection@collection:private
  item:private/006#collection@collection:private
  item:private/007#collection@collection:private
  item:private/008#collection@collection:private
  item:private/009#collection@collection:private
  item:private/010#collection@collection:priva
assertions:
  assertTrue:
    - collection:public#read@user:alice
    - collection:public#read@user:0
    - item:public/001#read@user:0
    - collection:public#read@user:alice
    - collection:public#add_item@user:alice
    - collection:public#update@user:alice
    - collection:public#delete@user:alice
    - collection:public#add_item@user:bob
    - collection:public#delete@user:bob
    - collection:private#read@user:alice
    - collection:private#add_item@user:alice
    - item:private/001#read@user:alice
    - item:private/001#delete@user:alice
    - item:public/001#read@user:some-new-user
  assertFalse:
    - collection:private#add_item@user:bob
    - collection:public#add_item@user:0
    - collection:private#add_item@user:0
    - item:private/001#delete@user:0
    - item:private/002#read@user:0
validation:
  collection:private#add_item:
    - "[team:admins#owner_or_member] is <collection:private#owner>"
    - "[team:super_admins#owner_or_member] is <team:admins#owner>"
    - "[user:alice] is <team:super_admins#owner>"
  collection:private#read:
    - "[team:admins#owner_or_member] is <collection:private#owner>"
    - "[team:super_admins#owner_or_member] is <team:admins#owner>"
    - "[user:alice] is <team:super_admins#owner>"
  collection:private#transfer_ownership:
    - "[team:admins#owner_or_member] is <collection:private#owner>"
    - "[team:super_admins#owner_or_member] is <team:admins#owner>"
    - "[user:alice] is <team:super_admins#owner>"
  collection:public#add_item:
    - "[team:admins#owner_or_member] is <team:editors#owner>"
    - "[team:editors#owner_or_member] is <collection:public#editor>/<collection:public#owner>"
    - "[team:super_admins#owner_or_member] is <team:admins#owner>"
    - "[user:alice] is <team:super_admins#owner>"
    - "[user:bob] is <team:editors#member>"
  collection:public#delete:
    - "[team:admins#owner_or_member] is <team:editors#owner>"
    - "[team:editors#owner_or_member] is <collection:public#owner>"
    - "[team:super_admins#owner_or_member] is <team:admins#owner>"
    - "[user:alice] is <team:super_admins#owner>"
    - "[user:bob] is <team:editors#member>"
  collection:public#read:
    - "[team:admins#owner_or_member] is <team:editors#owner>"
    - "[team:editors#owner_or_member] is <collection:public#editor>/<collection:public#owner>"
    - "[team:super_admins#owner_or_member] is <team:admins#owner>"
    - "[user:*] is <collection:public#reader>"
    - "[user:alice] is <team:super_admins#owner>"
    - "[user:bob] is <team:editors#member>"
  collection:public#transfer_ownership:
    - "[team:admins#owner_or_member] is <team:editors#owner>"
    - "[team:editors#owner_or_member] is <collection:public#owner>"
    - "[team:super_admins#owner_or_member] is <team:admins#owner>"
    - "[user:alice] is <team:super_admins#owner>"
    - "[user:bob] is <team:editors#member>"
  item:private/002#read:
    - "[team:admins#owner_or_member] is <collection:private#owner>"
    - "[team:super_admins#owner_or_member] is <team:admins#owner>"
    - "[user:alice] is <team:super_admins#owner>"
  item:public/001#read:
    - "[team:admins#owner_or_member] is <team:editors#owner>"
    - "[team:editors#owner_or_member] is <collection:public#editor>/<collection:public#owner>"
    - "[team:super_admins#owner_or_member] is <team:admins#owner>"
    - "[user:*] is <collection:public#reader>"
    - "[user:alice] is <team:super_admins#owner>"
    - "[user:bob] is <team:editors#member>"
